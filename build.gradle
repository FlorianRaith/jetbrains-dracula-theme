plugins {
    id 'org.jetbrains.intellij' version '0.4.9'
}

group 'com.vermouthx'
version '1.3.15'

repositories {
    mavenCentral()
}

intellij {
    version '2019.1'
}

patchPluginXml {
    sinceBuild '191'
    untilBuild '192.*'

    def changelogPath = "${project.buildDir}/CHANGELOG.html"
    def readmePath = "${project.buildDir}/README.html"

    if (file(changelogPath).exists()) {
        changeNotes file(changelogPath).text
    }
    if (file(readmePath).exists()) {
        pluginDescription file(readmePath).text
    }
}

def retrieveSecret = { String prop, String env ->
    project.hasProperty(prop) ? project.findProperty(prop) : System.getenv(env)
}

publishPlugin {
    username retrieveSecret('publishUsername', 'JETBRAINS_PUBLISH_USERNAME')
    token retrieveSecret('publishToken', 'JETBRAINS_PUBLISH_TOKEN')
}