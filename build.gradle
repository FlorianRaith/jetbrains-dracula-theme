plugins {
    id 'org.jetbrains.intellij' version '0.4.8'
}

group 'com.vermouthx'
version '1.3.2'

repositories {
    mavenCentral()
}

intellij {
    version '2019.1'
}

patchPluginXml {
    sinceBuild '191'

    def changelogPath = "$projectDir/build/CHANGELOG.html"

    if (file(changelogPath).exists()) {
        changeNotes file(changelogPath).text
    }
}

def retrieveSecret = { String prop, String env ->
    project.hasProperty(prop) ? project.findProperty(prop) : System.getenv(env)
}

publishPlugin {
    username retrieveSecret('publishUsername', 'JETBRAINS_PUBLISH_USERNAME')
    token retrieveSecret('publishToken', 'JETBRAINS_PUBLISH_TOKEN')
}